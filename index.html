<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>位置回報</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #map { height: 400px; width: 100%; margin-top: 15px; }
        button { padding: 10px 20px; font-size: 18px; margin-top: 15px; }
        #coords { margin-top: 10px; font-size: 16px; }
    </style>
</head>
<body>
    <h2>回報您的位置</h2>
    <p>請按下按鈕並允許定位，將會顯示您的位置</p>
    <button onclick="getLocation()">取得位置</button>
    <div id="coords"></div>
    <button id="copyBtn" style="display:none;" onclick="copyCoords()">複製座標</button>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        let map, marker;

        function getLocation() {
            if (navigator.geolocation) {
                document.getElementById("coords").innerText = "正在取得位置...";
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                document.getElementById("coords").innerText = "瀏覽器不支援定位功能";
            }
        }

        function showPosition(position) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            document.getElementById("coords").innerHTML = `經度: ${lon}<br>緯度: ${lat}`;
            document.getElementById("copyBtn").style.display = "inline-block";

            if (!map) {
                map = L.map('map').setView([lat, lon], 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap'
                }).addTo(map);
                marker = L.marker([lat, lon]).addTo(map);
            } else {
                map.setView([lat, lon], 15);
                marker.setLatLng([lat, lon]);
            }
        }

        function showError(error) {
            let msg = "";
            switch(error.code) {
                case error.PERMISSION_DENIED: msg = "使用者拒絕提供位置"; break;
                case error.POSITION_UNAVAILABLE: msg = "無法取得位置資訊"; break;
                case error.TIMEOUT: msg = "請求超時"; break;
                default: msg = "未知錯誤"; break;
            }
            document.getElementById("coords").innerText = msg;
        }

        function copyCoords() {
            const text = document.getElementById("coords").innerText.replace(/\n/g, ' ');
            navigator.clipboard.writeText(text);
            alert("座標已複製，可以貼給朋友或警方");
        }
    </script>
</body>
</html>
